# üöÄ Cyber Trek: Voyage into Secure Infrastructure

## üìã Vis√£o Geral

Bem-vindo ao **Cyber Trek: Voyage into Secure Infrastructure**, uma jornada emocionante de aventura cibern√©tica fict√≠cia. Neste desafio, voc√™ embarcar√° em uma expedi√ß√£o ao cora√ß√£o da infraestrutura digital segura. Como aventureiro cibern√©tico, sua miss√£o √© navegar pelos cen√°rios de seguran√ßa do Amazon CloudFront e Amazon S3, fortificando sua fortaleza digital contra amea√ßas cibern√©ticas iminentes.

Voc√™ √© um especialista rookie em seguran√ßa cibern√©tica encarregado de proteger o site est√°tico "Cyber Trek Voyage" hospedado no Amazon Web Services (AWS). Prepare-se para embarcar em uma jornada perigosa atrav√©s das vastas extens√µes da infraestrutura segura, onde cada decis√£o pode significar a diferen√ßa entre vit√≥ria e derrota.

## üéØ Objetivos de Aprendizado

- ‚úÖ Implementar controle de acesso restrito entre CloudFront e S3 usando OAC
- ‚úÖ Configurar redirecionamento autom√°tico HTTP para HTTPS
- ‚úÖ Otimizar pol√≠ticas de cache para balancear performance e atualiza√ß√£o de conte√∫do
- ‚úÖ Habilitar versionamento de objetos para prote√ß√£o contra exclus√µes acidentais
- ‚úÖ Aplicar princ√≠pios de least privilege em pol√≠ticas de bucket
- ‚úÖ Garantir criptografia em tr√¢nsito para todas as comunica√ß√µes
- ‚úÖ Entender arquitetura CloudFront + S3 para sites est√°ticos

## üèóÔ∏è Arquitetura

```
Internet
    ‚Üì
Amazon CloudFront Distribution
‚îú‚îÄ‚îÄ HTTPS (Redirect HTTP ‚Üí HTTPS)
‚îú‚îÄ‚îÄ Cache Policy (TTL = 1 hour)
‚îú‚îÄ‚îÄ Origin Access Control (OAC)
‚îî‚îÄ‚îÄ Origin: Amazon S3 Bucket
    ‚îú‚îÄ‚îÄ Bucket Policy (CloudFront only)
    ‚îú‚îÄ‚îÄ Block Public Access (Enabled)
    ‚îî‚îÄ‚îÄ Versioning (Enabled)
```

## üõ†Ô∏è Servi√ßos Utilizados

- **Amazon CloudFront** - CDN global para distribui√ß√£o de conte√∫do
- **Amazon S3** - Armazenamento de objetos e hospedagem de site est√°tico
- **IAM** - Controle de acesso e pol√≠ticas
- **AWS Secrets Manager** - Armazenamento de credenciais (impl√≠cito)

## üìö Conceitos Principais

### 1. **Origin Access Control (OAC)**
- M√©todo moderno para restringir acesso do CloudFront ao S3
- Substitui o OAI (Origin Access Identity) legado
- Permite acesso apenas via CloudFront, bloqueando acesso p√∫blico direto

### 2. **HTTPS e Seguran√ßa em Tr√¢nsito**
- Redirecionamento autom√°tico HTTP ‚Üí HTTPS
- Criptografia TLS para prote√ß√£o de dados
- Preven√ß√£o de ataques de intercepta√ß√£o (eavesdropping)

### 3. **Cache Performance e TTL**
- Balanceamento entre performance e atualiza√ß√£o de conte√∫do
- Default TTL de 3600 segundos (1 hora)
- Otimiza√ß√£o para atualiza√ß√£o peri√≥dica do conte√∫do

### 4. **S3 Versioning**
- Prote√ß√£o contra exclus√µes acidentais
- Hist√≥rico de modifica√ß√µes de objetos
- Capacidade de restaura√ß√£o r√°pida

## üöÄ Passo a Passo Detalhado

### **Task 1: Access Control Lockdown Quest** (45 pontos)

#### Objetivo
Restringir o acesso ao bucket S3 para que apenas a distribui√ß√£o CloudFront autorizada possa acessar os objetos.

#### Contexto do Problema
O site apresentava erro `AccessDenied` ao ser acessado pelo dom√≠nio CloudFront porque a pol√≠tica do bucket S3 n√£o estava configurada corretamente para permitir acesso via Origin Access Control (OAC).

#### Solu√ß√£o

**1. Identificar os Recursos**
- CloudFront Distribution ID: (verificar em Output Properties)
- Bucket S3: `static-website-jam-*` (nome come√ßa com este prefixo)

**2. Confirmar Configura√ß√£o OAC**
- V√° para **CloudFront** ‚Üí **Distributions** ‚Üí sua distribui√ß√£o
- Aba **Origins** ‚Üí verifique que est√° usando **Origin Access Control**

**3. Configurar Bucket Policy**

V√° para **S3** ‚Üí seu bucket ‚Üí **Permissions** ‚Üí **Bucket policy**

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowCloudFrontOACOnly",
      "Effect": "Allow",
      "Principal": {
        "Service": "cloudfront.amazonaws.com"
      },
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::static-website-jam-XXXXXX/*",
      "Condition": {
        "StringEquals": {
          "AWS:SourceArn": "arn:aws:cloudfront::<ACCOUNT_ID>:distribution/<DISTRIBUTION_ID>"
        }
      }
    },
    {
      "Sid": "DenyInsecureTransport",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::static-website-jam-XXXXXX/*",
      "Condition": {
        "Bool": {
          "aws:SecureTransport": "false"
        }
      }
    }
  ]
}
```

**Substitua:**
- `static-website-jam-XXXXXX` pelo nome real do seu bucket
- `<ACCOUNT_ID>` pelo n√∫mero da sua conta AWS (12 d√≠gitos)
- `<DISTRIBUTION_ID>` pelo ID da sua distribui√ß√£o CloudFront

**4. Validar Configura√ß√£o**
- ‚úÖ Block all public access: **Habilitado**
- ‚úÖ Acesso direto ao S3: **Negado** (Access Denied)
- ‚úÖ Acesso via CloudFront: **Funciona normalmente**

---

### **Task 2: Secure Communication Protocol Challenge** (30 pontos)

#### Objetivo
Garantir que toda comunica√ß√£o entre cliente e CloudFront seja exclusivamente via HTTPS.

#### Contexto do Problema
O site permitia conex√µes HTTP n√£o criptografadas, expondo dados a potenciais ataques de intercepta√ß√£o.

#### Solu√ß√£o

**1. Acessar Configura√ß√£o de Behaviors**
- **CloudFront** ‚Üí sua distribui√ß√£o
- Aba **Behaviors**
- Selecione o comportamento **Default (*)** ‚Üí **Edit**

**2. Configurar Viewer Protocol Policy**
- Localize: **Viewer Protocol Policy**
- Altere de: `HTTP and HTTPS`
- Para: **`Redirect HTTP to HTTPS`**
- Salve as altera√ß√µes

**3. Aguardar Deploy**
- Status da distribui√ß√£o deve mudar para **Deployed**
- Pode levar alguns minutos

**4. Validar Redirecionamento**
```bash
# Teste HTTP (deve redirecionar)
curl -I http://dxxxxxx.cloudfront.net

# Teste HTTPS (deve funcionar)
curl -I https://dxxxxxx.cloudfront.net
```

---

### **Task 3: Cache Performance Optimization Expedition** (45 pontos)

#### Objetivo
Otimizar o cache do CloudFront para atualizar automaticamente a cada 1 hora, sincronizando com o ciclo de atualiza√ß√£o do S3.

#### Contexto do Problema
O site n√£o exibia conte√∫do atualizado porque o cache estava configurado com TTL muito alto, mantendo objetos antigos nos edge locations.

#### Solu√ß√£o

**1. Acessar Configura√ß√£o de Behaviors**
- **CloudFront** ‚Üí sua distribui√ß√£o
- Aba **Behaviors**
- Selecione **Default (*)** ‚Üí **Edit**

**2. Criar ou Selecionar Cache Policy**

**Op√ß√£o A: Criar nova Cache Policy**
- Em **Cache policy**, clique em **Create policy**
- Nome: `one-hour-ttl`
- Configure:

| Par√¢metro | Valor | Descri√ß√£o |
|-----------|-------|-----------|
| Minimum TTL | `0` seconds | Permite atualiza√ß√£o imediata |
| Default TTL | `3600` seconds (1 hour) | Cache renovado a cada hora |
| Maximum TTL | `3600` seconds (1 hour) | Garante consist√™ncia |

**Op√ß√£o B: Editar comportamento diretamente**
- Altere para: **Cache policy and origin request policy (recommended)**
- Selecione a policy criada ou configure TTLs customizados

**3. Configura√ß√µes Adicionais de Cache**
- **Headers:** None (mant√©m cache simples)
- **Query strings:** None (evita varia√ß√µes desnecess√°rias)
- **Cookies:** None (melhora performance)

**4. Salvar e Aguardar Deploy**
- Salve as altera√ß√µes
- Aguarde status **Deployed**

**5. Validar Atualiza√ß√£o de Cache**
- Atualize conte√∫do no S3
- Aguarde at√© 1 hora
- Verifique se o site exibe novo conte√∫do

---

### **Task 4: Version Control Vigilance Assignment** (30 pontos)

#### Objetivo
Ativar versionamento no bucket S3 para prote√ß√£o contra exclus√µes acidentais e manter hist√≥rico de altera√ß√µes.

#### Contexto do Problema
Um objeto cr√≠tico foi acidentalmente exclu√≠do, causando interrup√ß√£o no servi√ßo. A equipe teve que recriar manualmente porque n√£o havia vers√µes anteriores.

#### Solu√ß√£o

**1. Acessar Configura√ß√£o do Bucket**
- **S3** ‚Üí seu bucket `static-website-jam-*`
- Aba **Properties**

**2. Habilitar Versioning**
- Localize a se√ß√£o **Bucket Versioning**
- Clique em **Edit**
- Selecione: **Enable**
- **Save changes**

**3. Validar Versionamento**
```bash
# Via AWS CLI
aws s3api get-bucket-versioning --bucket static-website-jam-XXXXXX

# Resposta esperada:
{
    "Status": "Enabled"
}
```

**4. Testar Recupera√ß√£o (Opcional)**
- Fa√ßa upload de um arquivo
- Atualize o mesmo arquivo
- Na aba **Objects** ‚Üí **Show versions**
- Voc√™ ver√° m√∫ltiplas vers√µes do objeto

**5. Restaurar Vers√£o Anterior (Se necess√°rio)**
- Selecione a vers√£o desejada
- **Actions** ‚Üí **Download** ou **Delete delete marker**

## üîç Valida√ß√£o Completa

### Checklist de Seguran√ßa
- [ ] **Bucket privado:** Block all public access habilitado
- [ ] **Acesso restrito:** Apenas CloudFront pode acessar S3
- [ ] **HTTPS obrigat√≥rio:** Todas as conex√µes redirecionadas
- [ ] **Cache otimizado:** TTL de 1 hora configurado
- [ ] **Versioning ativo:** Prote√ß√£o contra exclus√µes
- [ ] **Least privilege:** Pol√≠ticas com permiss√µes m√≠nimas

### Testes de Valida√ß√£o

**Teste 1: Acesso Direto ao S3 (deve falhar)**
```bash
curl -I https://static-website-jam-XXXXXX.s3.amazonaws.com/index.html
# Esperado: 403 Forbidden ou Access Denied
```

**Teste 2: Acesso via CloudFront (deve funcionar)**
```bash
curl -I https://dxxxxxx.cloudfront.net/
# Esperado: 200 OK
```

**Teste 3: Redirecionamento HTTP (deve redirecionar)**
```bash
curl -I http://dxxxxxx.cloudfront.net/
# Esperado: 301 ou 302 com Location: https://...
```

**Teste 4: Cache Header**
```bash
curl -I https://dxxxxxx.cloudfront.net/
# Verifique headers: Cache-Control, Age, X-Cache
```

## üéì Conceitos Aprendidos

### **CloudFront + S3 Architecture**
- **OAC vs OAI:** Diferen√ßas e quando usar cada um
- **Bucket policies:** Configura√ß√£o para acesso via CloudFront
- **Cache behaviors:** Controle de como conte√∫do √© cacheado
- **Viewer protocols:** Controle de protocolos aceitos

### **Seguran√ßa em Profundidade**
- **Least privilege:** Permiss√µes m√≠nimas necess√°rias
- **Defense in depth:** M√∫ltiplas camadas de seguran√ßa
- **Encryption in transit:** HTTPS em todas as conex√µes
- **Access control:** Restri√ß√£o por ARN e condi√ß√µes

### **Performance e Disponibilidade**
- **Cache optimization:** Balanceamento de TTLs
- **Global distribution:** Edge locations para baixa lat√™ncia
- **Version control:** Prote√ß√£o e recupera√ß√£o de dados
- **Content freshness:** Atualiza√ß√£o autom√°tica de cache

## ‚ö†Ô∏è Pontos de Aten√ß√£o

### **Origin Access Control (OAC)**
- **Obrigat√≥rio:** Use o ARN completo da distribui√ß√£o na policy
- **Service principal:** Sempre use `cloudfront.amazonaws.com`
- **Condi√ß√£o StringEquals:** AWS:SourceArn √© case-sensitive

### **Cache Configuration**
- **TTL values:** Minimum ‚â§ Default ‚â§ Maximum
- **Content updates:** Cache pode demorar at√© o TTL expirar
- **Invalidations:** Use com cautela (tem custos)

### **Versioning**
- **Custos:** Armazena todas as vers√µes (aumenta custos)
- **Delete markers:** Exclus√µes criam markers, n√£o removem
- **Lifecycle policies:** Configure para gerenciar vers√µes antigas

### **Deploy Time**
- **CloudFront:** Mudan√ßas levam 5-15 minutos para propagar
- **Cache:** Espere o TTL expirar para ver mudan√ßas
- **Testing:** Use invalidations para testes r√°pidos

## üîß Troubleshooting Comum

### **403 Access Denied via CloudFront**
- Verifique se OAC est√° configurado na origem
- Confirme que a bucket policy inclui o ARN correto
- Valide que o account ID est√° correto na policy

### **HTTP n√£o redireciona para HTTPS**
- Aguarde deploy da distribui√ß√£o completar
- Limpe cache do navegador
- Teste com curl ou modo inc√≥gnito

### **Conte√∫do n√£o atualiza**
- Verifique se o TTL est√° configurado corretamente
- Aguarde o tempo do TTL expirar
- Use invalidation para for√ßar atualiza√ß√£o

### **Versioning n√£o funciona**
- Confirme que est√° habilitado em Properties
- Verifique se o status √© "Enabled"
- Use "Show versions" para ver vers√µes ocultas

## üìñ Recursos Adicionais

### **Documenta√ß√£o AWS**
- [CloudFront Origin Access Control](https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/private-content-restricting-access-to-s3.html)
- [CloudFront Cache Behaviors](https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/distribution-web-values-specify.html#DownloadDistValuesCacheBehavior)
- [S3 Versioning](https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html)
- [S3 Bucket Policies](https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucket-policies.html)

### **Boas Pr√°ticas**
- **Security:** Use HTTPS, OAC e bucket policies restritivas
- **Performance:** Configure cache TTLs apropriados
- **Cost optimization:** Use lifecycle policies para vers√µes antigas
- **Monitoring:** Configure CloudWatch alarms e logs

### **Pr√≥ximos Passos**
- **WAF:** Adicionar Web Application Firewall
- **Custom domains:** Configurar dom√≠nios pr√≥prios
- **Lambda@Edge:** Processar requisi√ß√µes nas edges
- **CloudFront Functions:** Transforma√ß√µes leves de conte√∫do

## üèÜ Crit√©rios de Sucesso

- [ ] **Task 1:** Acesso restrito apenas via CloudFront (45 pts)
- [ ] **Task 2:** HTTPS obrigat√≥rio com redirecionamento (30 pts)
- [ ] **Task 3:** Cache atualizado a cada 1 hora (45 pts)
- [ ] **Task 4:** Versioning habilitado no bucket (30 pts)
- [ ] **Total:** 150 pontos

## üéØ Cen√°rios de Aplica√ß√£o

### **Ambiente Corporativo**
- **Sites est√°ticos:** Landing pages, documenta√ß√£o, SPAs
- **Distribui√ß√£o global:** Baixa lat√™ncia para usu√°rios mundiais
- **Seguran√ßa:** Prote√ß√£o de conte√∫do sens√≠vel
- **Compliance:** HTTPS obrigat√≥rio para regulamenta√ß√µes

### **Aplica√ß√µes Web Modernas**
- **React/Vue/Angular:** Deploy de SPAs
- **JAMstack:** Sites est√°ticos com APIs
- **E-commerce:** Cat√°logos de produtos
- **Marketing:** Sites promocionais e campanhas

---

**üéâ Parab√©ns!** Voc√™ completou o Cyber Trek: Voyage into Secure Infrastructure! Voc√™ implementou com sucesso uma arquitetura segura e perform√°tica para distribui√ß√£o de conte√∫do est√°tico usando CloudFront e S3.

> **üí° Dica:** Esta arquitetura √© a base para muitas aplica√ß√µes web modernas. Combine com Lambda@Edge, API Gateway e servi√ßos serverless para criar aplica√ß√µes completas e escal√°veis na AWS.