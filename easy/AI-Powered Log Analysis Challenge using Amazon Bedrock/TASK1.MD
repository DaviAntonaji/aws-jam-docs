# Task 1: Enabling Amazon Nova Model Access in Bedrock

## üéØ Objetivo

Resolver o erro `AccessDeniedException` ao tentar usar o modelo Amazon Nova Lite no Bedrock, habilitando o acesso ao modelo para que a fun√ß√£o Lambda `bedrock-api-function` possa processar logs automaticamente.

## üìä Cen√°rio

### Situa√ß√£o Inicial
- ‚úÖ **Lambda function** `bedrock-api-function` criada e configurada
- ‚úÖ **IAM roles** b√°sicos configurados
- ‚ùå **Modelo Amazon Nova Lite** n√£o acess√≠vel
- ‚ùå **Fun√ß√£o falhando** com `AccessDeniedException`

### Problema Identificado
```
AccessDeniedException: Could not access the model amazon.nova-lite-v1:0.
Make sure this model is available in your region and you have access to it.
```

## üîç Diagn√≥stico

### An√°lise dos Logs
1. **Acessar CloudWatch Logs** da fun√ß√£o `bedrock-api-function`
2. **Identificar erro** de acesso ao modelo
3. **Confirmar** que o modelo n√£o est√° habilitado

### Error Pattern T√≠pico
```json
{
  "errorMessage": "AccessDeniedException",
  "errorType": "ClientError", 
  "stackTrace": [
    "botocore.exceptions.ClientError: An error occurred (AccessDeniedException) when calling the InvokeModel operation: Could not access the model amazon.nova-lite-v1:0. Make sure this model is available in your region and you have access to it."
  ]
}
```

## üîß Resolu√ß√£o

### Passo a Passo Detalhado

#### 1. Acessar Amazon Bedrock Console
1. **Abrir AWS Console**
2. **Navegar para Amazon Bedrock**
3. **Verificar regi√£o** (deve estar na mesma regi√£o da Lambda)

#### 2. Configurar Model Access
1. **No menu lateral**, clicar em **"Model access"**
2. **Localizar "Amazon Nova Lite"** na lista de modelos
3. **Verificar status** atual (provavelmente "Not available")
4. **Clicar em "Manage model access"**

#### 3. Habilitar Amazon Nova Lite
1. **Na p√°gina de model access**, localizar **"Amazon Nova Lite"**
2. **Marcar a checkbox** ao lado do modelo
3. **Revisar termos** de uso se solicitado
4. **Clicar em "Request model access"**
5. **Aguardar aprova√ß√£o** (geralmente instant√¢nea em labs)

#### 4. Verificar Ativa√ß√£o
1. **Aguardar status** mudar para "Available" ou "Access granted"
2. **Confirmar modelo** est√° listado como acess√≠vel
3. **Anotar model ID**: `amazon.nova-lite-v1:0`

### Configura√ß√£o Visual
```
Amazon Bedrock Console
    ‚Üì
Model Access
    ‚Üì
Amazon Nova Lite: ‚ùå Not available
    ‚Üì (Request Access)
Amazon Nova Lite: ‚úÖ Available
```

## ‚úÖ Valida√ß√£o

### Teste da Fun√ß√£o Lambda
1. **Acessar Lambda Console** ‚Üí `bedrock-api-function`
2. **Clicar em "Test"** para executar fun√ß√£o
3. **Verificar sa√≠da** sem erros de acesso
4. **Confirmar** processamento de logs

### Comandos de Teste
```bash
# Testar fun√ß√£o Lambda
aws lambda invoke \
  --function-name bedrock-api-function \
  --payload '{}' \
  response.json

# Verificar resposta
cat response.json

# Verificar logs
aws logs describe-log-streams \
  --log-group-name /aws/lambda/bedrock-api-function \
  --order-by LastEventTime \
  --descending
```

### Sa√≠da Esperada
```json
{
  "statusCode": 200,
  "body": "Log analysis completed successfully",
  "logs_processed": 0,
  "analysis_summary": "No logs found in specified time range"
}
```

## üîç Detalhes T√©cnicos

### Amazon Nova Models Dispon√≠veis
| Modelo | Model ID | Capacidades |
|--------|----------|-------------|
| **Nova Lite** | `amazon.nova-lite-v1:0` | Text generation, analysis |
| **Nova Micro** | `amazon.nova-micro-v1:0` | Lightweight text tasks |
| **Nova Pro** | `amazon.nova-pro-v1:0` | Advanced text generation |

### Model Access Status
```bash
# Verificar modelos dispon√≠veis via CLI
aws bedrock list-foundation-models \
  --region us-east-1 \
  --query 'modelSummaries[?contains(modelId, `nova`)]'

# Verificar acesso espec√≠fico ao Nova Lite
aws bedrock invoke-model \
  --region us-east-1 \
  --model-id amazon.nova-lite-v1:0 \
  --body '{"inputText":"Test","textGenerationConfig":{"maxTokenCount":50}}' \
  --content-type application/json \
  response.json
```

### IAM Permissions Necess√°rias
A fun√ß√£o Lambda precisa das seguintes permiss√µes:
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "bedrock:InvokeModel",
        "bedrock:InvokeModelWithResponseStream"
      ],
      "Resource": "arn:aws:bedrock:*::foundation-model/amazon.nova-lite-v1:0"
    }
  ]
}
```

## üö® Troubleshooting

### Problemas Comuns

#### Modelo ainda n√£o dispon√≠vel ap√≥s request
- **Aguardar propaga√ß√£o** (pode levar 2-5 minutos)
- **Verificar regi√£o** (modelo deve estar na mesma regi√£o da Lambda)
- **Tentar refresh** da p√°gina do console
- **Verificar quotas** da conta AWS

#### AccessDeniedException persiste
- **Confirmar IAM permissions** da fun√ß√£o Lambda
- **Verificar resource-based policies**
- **Checar se modelo est√° realmente "Available"**
- **Tentar outro modelo** (Nova Micro) para teste

#### Throttling errors
- **Aguardar entre tentativas** (rate limiting em labs)
- **Verificar quotas** de requests per minute
- **Implementar retry logic** com backoff

### Comandos de Diagn√≥stico
```bash
# Verificar status dos modelos
aws bedrock list-foundation-models \
  --query 'modelSummaries[?contains(modelId, `amazon.nova`)].[modelId,modelLifecycle.status]' \
  --output table

# Testar acesso direto ao modelo
aws bedrock invoke-model \
  --model-id amazon.nova-lite-v1:0 \
  --body '{"inputText":"Hello","textGenerationConfig":{"maxTokenCount":10}}' \
  --content-type application/json \
  test-response.json

# Verificar IAM permissions da fun√ß√£o
aws lambda get-function --function-name bedrock-api-function \
  --query 'Configuration.Role'
```

## üí° Considera√ß√µes Importantes

### Custos
- **Amazon Nova Lite** tem custo por token processado
- **Ambiente de lab** pode ter quotas limitadas
- **Monitorar uso** para evitar custos inesperados

### Quotas e Limites
```
Requests per Minute (RPM): 100-1000 (varia por regi√£o)
Tokens per Minute (TPM): 10,000-100,000
Tokens per Day (TPD): 1,000,000
```

### Regi√µes Dispon√≠veis
- **us-east-1** (N. Virginia) - Disponibilidade completa
- **us-west-2** (Oregon) - Disponibilidade completa  
- **eu-west-1** (Ireland) - Limitada
- **Verificar documenta√ß√£o** para updates de disponibilidade

## üìä Valida√ß√£o Final

### Checklist de Verifica√ß√£o
- [ ] Modelo Amazon Nova Lite est√° "Available" no Bedrock Console
- [ ] Fun√ß√£o Lambda executa sem `AccessDeniedException`
- [ ] CloudWatch Logs mostram execu√ß√£o bem-sucedida
- [ ] Response da fun√ß√£o retorna status 200
- [ ] Task 1 marcada como "Completed" no Jam

### M√©tricas de Sucesso
- **Error Rate:** 0% para AccessDeniedException
- **Success Rate:** 100% para invoca√ß√µes de modelo
- **Latency:** < 5 segundos para an√°lise b√°sica
- **Cost:** Dentro dos limites de quota do lab

## üéì Li√ß√µes Aprendidas

### Amazon Bedrock
- **Model Access** √© um pr√©-requisito obrigat√≥rio
- **Regional availability** varia por modelo
- **Quotas** s√£o importantes em ambiente de produ√ß√£o
- **Cost management** deve ser considerado desde o in√≠cio

### Troubleshooting
- **Error messages** s√£o geralmente precisos e informativos
- **Console UI** √© a forma mais simples de configurar acesso
- **CLI commands** s√£o √∫teis para automa√ß√£o e verifica√ß√£o
- **Propagation time** deve ser considerado

### Integra√ß√£o Lambda + Bedrock
- **IAM permissions** devem ser espec√≠ficas por modelo
- **Error handling** √© crucial para resili√™ncia
- **Retry logic** ajuda com throttling tempor√°rio
- **Monitoring** √© essencial para produ√ß√£o

---

**üéâ Task 1 Conclu√≠da!**

> **üí≠ Reflex√£o:** A habilita√ß√£o de acesso a modelos de IA no Bedrock √© um passo fundamental que demonstra como a AWS gerencia o acesso a recursos de IA de forma granular. Este controle permite tanto seguran√ßa quanto gest√£o de custos, essenciais em ambientes de produ√ß√£o.
